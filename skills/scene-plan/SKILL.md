---
name: scene-plan
description: 场景规划工具，完成场景清单（步骤8）→场景详细规划（步骤9）的完整场景设计链。当用户说"场景规划"、"规划场景"、"场景设计"、"场景清单"、"规划章节"时自动激活。可独立使用，也可在 snowflake-fiction 主流程中被调用。支持全量规划和局部重跑。
version: 1.0.0
---

# 场景规划 Skill

覆盖雪花写作法中场景线的完整两步链：

| 步骤 | 内容 | 输出物 |
|------|------|--------|
| 步骤8 | 场景清单（所有场景的结构化列表） | `05-场景清单.md` |
| 步骤9 | 场景详细规划（每个场景的三要素展开） | `06-场景规划/场景[#]-[名].md` |

## 使用时机

- 大纲完成后，进入正文创作前
- 修改大纲后，需要重新规划受影响的章节
- 创作中途发现某章节场景设计有问题，局部重跑
- 独立设计某几章的场景，不走完整流程

---

## 三种使用模式

### 模式A：全量规划（默认）

基于完整大纲，生成所有章节的场景清单和详细规划。

```
/scene-plan
/scene-plan --from 03-完整大纲.md
```

执行顺序：步骤8（全量清单）→ 步骤9（逐场景规划）

### 模式B：局部规划（指定章节）

只规划指定章节范围，适合修改大纲后的局部重跑。

```
/scene-plan 第3章
/scene-plan 第3章-第5章
/scene-plan 第3章 第7章 第10章
```

执行顺序：更新清单中对应行 → 重新生成指定章节的场景规划文件

### 模式C：仅生成清单（步骤8）

只生成场景清单，不展开详细规划。适合快速预览结构。

```
/scene-plan --list-only
/scene-plan 第1章-第5章 --list-only
```

---

## 详细执行流程

### 步骤8：场景清单

**目标**：将大纲中的每个章节拆解为具体场景，形成结构化清单

**执行方式**：
1. 读取完整大纲文件（`03-完整大纲.md` 或用户指定文件）
2. 如果存在人物宝典，一并读取（确保 POV 和人物信息准确）
3. 为每个章节拆解场景，遵守以下规则：
   - 每个场景必须有明确冲突，无纯过渡场景
   - 标注场景类型（主动/被动）
   - 主动-被动场景交替出现，避免连续同类型
4. 生成统计信息（总场景数、类型分布、冲突类型分布）
5. 用户确认清单后，进入步骤9

**场景拆解原则**：

| 原则 | 说明 |
|------|------|
| 冲突必须存在 | 每个场景都要有人vs人/人vs自我/人vs环境的冲突 |
| 无过渡场景 | "主角走去咖啡馆"不是场景，"主角在咖啡馆被拒绝"才是 |
| 主被动交替 | 主动场景后接被动场景，形成节奏感 |
| 冲突强度递增 | 后期场景的冲突强度要高于前期 |

**输出格式**：

```markdown
## 场景清单

| # | 章节 | 场景名 | 地点 | POV | 参与人物 | 核心冲突 | 类型 | 预估字数 |
|---|------|--------|------|-----|----------|----------|------|----------|
| 1 | 第1章 | 开场-梦想被否定 | 咖啡馆 | 主角 | 主、母 | 梦想被否定 | 主动 | 800 |
| 2 | 第1章 | 独处-自我怀疑 | 出租屋 | 主角 | 主 | 自我怀疑 | 被动 | 600 |

### 统计
- 总场景数：X
- 主动场景：X（占X%）
- 被动场景：X（占X%）
- 预估总字数：X万字

### 冲突类型分布
- 人vs人：X个
- 人vs自我：X个
- 人vs环境：X个
```

---

### 步骤9：场景详细规划

**目标**：为每个场景展开三要素，形成写作时的详细参考

**执行方式**：
1. 读取步骤8生成的场景清单
2. 逐场景展开，根据类型选择对应模板：
   - **主动场景**：目标 → 冲突 → 挫折
   - **被动场景**：反应 → 困难 → 决定
3. 补充场景细节（开场画面、关键对话、转折点、结尾画面）
4. 绘制情绪曲线
5. 每个场景保存为独立文件

**主动场景三要素**：

```
目标（Goal）：主角在这一场景想要达成什么？
  ├── 表面目标（他说他想要什么）
  └── 深层动机（他真正想要什么）

冲突（Conflict）：什么力量阻碍他？
  ├── 人物冲突（谁在阻碍？）
  ├── 环境冲突（什么环境障碍？）
  └── 内心冲突（什么内心挣扎？）

挫折（Disaster）：结果如何？
  ├── 不能完全成功（要有代价）
  └── 开启下一个场景的钩子
```

**被动场景三要素**：

```
反应（Reaction）：主角对上一场景挫折的反应
  ├── 情绪反应（愤怒/悲伤/恐惧/困惑）
  └── 行为反应（他做了什么？）

困难（Dilemma）：内心的两难选择
  ├── 选项A（好处 vs 代价）
  └── 选项B（好处 vs 代价）

决定（Decision）：做出什么新决定？
  └── 开启下一个主动场景
```

**参考模板**：[场景规划完整模板](../snowflake-fiction/references/scene-template.md)

---

## 输出管理

### 目录检测逻辑

```
1. 检查当前目录是否存在小说项目目录（含 03-完整大纲.md）
2. 如果存在 → 保存到该项目目录下
3. 如果不存在 → 询问用户大纲文件位置
4. 如果用户指定路径 → 优先使用用户指定路径
```

### 输出目录结构

```
[小说名]/
├── 05-场景清单.md              ← 步骤8输出（全量清单）
└── 06-场景规划/
    ├── 场景01-开场-梦想被否定.md  ← 步骤9输出（每场景一文件）
    ├── 场景02-独处-自我怀疑.md
    └── ...
```

### 局部重跑的文件处理

```
重跑第3章-第5章时：
1. 更新 05-场景清单.md 中对应行（保留其他行不变）
2. 删除 06-场景规划/ 中对应章节的旧文件
3. 生成新的场景规划文件
4. 输出变更摘要（哪些文件被更新/删除/新增）
```

---

## 节奏检查

生成场景清单后，自动执行节奏检查：

| 检查项 | 规则 | 警告条件 |
|--------|------|----------|
| 主被动交替 | 避免连续3个以上同类型场景 | 连续≥3个主动或被动场景 |
| 冲突强度 | 后期场景冲突强度 ≥ 前期 | 高潮前冲突强度低于中段 |
| 场景密度 | 每章2-4个场景为宜 | 单章场景数 ≥5 或 =1 |
| 无冲突场景 | 每个场景必须有冲突 | 核心冲突栏为空 |

节奏检查结果附在清单末尾，供用户调整。

---

## 与主流程的集成

当 `snowflake-fiction` 主 skill 执行到步骤8、9时，自动调用本 skill。

主流程调用方式：
```
# 主流程内部调用（用户不感知）
scene-plan --step 8 --from 03-完整大纲.md
scene-plan --step 9 --from 05-场景清单.md
```

独立调用时，本 skill 自动检测项目上下文，读取已有大纲文件。

---

## 注意事项

1. **先确认大纲**：步骤8依赖完整大纲，大纲未定稿前不建议规划场景
2. **清单先于规划**：必须先完成步骤8的清单，再展开步骤9的详细规划
3. **局部重跑时**：只更新指定章节，不影响其他章节的已有规划
4. **场景命名**：场景名要有张力，体现核心冲突（"梦想被否定"优于"咖啡馆对话"）
