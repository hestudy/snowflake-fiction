---
name: novel-review
description: 小说质量复核工具，检查角色一致性、时间线、设定冲突、大纲偏离、伏笔回收等问题。当用户说"小说复核"、"章节检查"、"一致性检查"、"质量检查"、"小说质检"时自动激活。使用子代理架构，支持长篇小说的增量检查。
version: 1.0.0
---

# 小说复核 Skill

本 Skill 用于对已创作的小说内容进行质量检查，主要解决长篇小说创作中的**一致性维护**问题。

## 核心问题

长篇小说创作（尤其是10万字以上）常面临：
- **角色状态漂移**：人物性格、能力、关系前后矛盾
- **时间线混乱**：季节、日期、年龄前后不一致
- **设定冲突**：世界观规则被无意打破
- **大纲偏离**：实际内容与规划不符
- **伏笔遗漏**：埋下的伏笔忘记回收

## 核心挑战

长篇小说可能有数十万甚至上百万字，一次性加载所有内容会导致上下文溢出。

## 解决方案

采用**子代理架构**，将检查任务拆分为独立的小任务：

```
主代理（orchestrator）
    ├── 子代理1：角色一致性检查
    ├── 子代理2：时间线检查
    ├── 子代理3：设定一致性检查
    ├── 子代理4：大纲偏离检查
    ├── 子代理5：伏笔回收检查
    └── 子代理6：文风一致性检查
```

**核心原则**：
1. **分段处理**：每个子代理只读取必要的文件片段
2. **增量检查**：只检查新增章节与已有内容的关系
3. **摘要先行**：使用摘要代替全文，必要时再深入
4. **分批执行**：将检查任务分批执行，避免 API 限流

---

## 使用方式

### 基础用法

```bash
/novel-review                              # 交互式引导
/novel-review ./novel-output/我的小说/      # 指定项目目录
/novel-review 第10章                        # 只检查指定章节
/novel-review 第5-10章                      # 检查章节范围
```

### 指定检查项

```bash
/novel-review --角色                        # 只检查角色一致性
/novel-review --时间线                      # 只检查时间线
/novel-review --设定                        # 只检查设定一致性
/novel-review --大纲                        # 只检查大纲偏离
/novel-review --伏笔                        # 只检查伏笔回收
/novel-review --文风                        # 只检查文风一致性（含流水账检测）
/novel-review --开篇                        # 只检查开篇质量（仅前3章）
/novel-review --评估准备                    # 推荐评估准备检查（番茄平台）⭐新增
/novel-review --全文                        # 全面检查（所有项）
```

### 输出格式

```bash
/novel-review --report                     # 生成完整报告
/novel-review --quick                      # 快速检查（摘要模式）
/novel-review --json                       # 输出 JSON 格式（便于程序处理）
```

---

## 检查项目详解

### 1. 角色一致性检查

**检查内容**：
- [ ] 性格行为是否符合设定
- [ ] 对话风格是否一致
- [ ] 能力等级是否合理变化
- [ ] 人物关系是否突变无铺垫
- [ ] 外貌描述是否一致
- [ ] 口头禅/习惯动作是否保持
- [ ] **人设扁平化检测**：所有角色说话风格是否雷同
- [ ] **配角工具人检测**：配角是否只为服务主角存在

**输入来源**：
- `人物卡片/` 或 `人物宝典/` 目录
- 待检查章节内容
- 前一章的角色状态摘要

**输出**：
- 问题列表（角色、位置、问题描述、严重程度）
- 修改建议

**人设扁平化检测要点**：
```
检查项：
1. 遮住角色名字，能否分辨是谁在说话？
2. 每个角色是否有独特的说话习惯/口头禅？
3. 配角是否有自己的目标和动机（不只是帮主角）？
```

---

### 2. 时间线检查

**检查内容**：
- [ ] 时间流逝是否合理
- [ ] 季节/天气是否连贯
- [ ] 角色年龄是否正确
- [ ] 事件顺序是否矛盾
- [ ] 白天/黑夜是否连贯

**输入来源**：
- `05-场景清单.md` 或专用时间线文件
- `review/timeline.json`（如有）
- 待检查章节中的时间标记

**输出**：
- 当前时间点更新
- 时间线问题列表
- 更新后的时间线摘要

---

### 3. 设定一致性检查

**检查内容**：
- [ ] 修炼等级/能力体系是否一致
- [ ] 物品属性是否变化
- [ ] 地点描述是否矛盾
- [ ] 规则是否被打破（如有例外需说明）
- [ ] 专有名词是否统一

**输入来源**：
- `00-一句话概括.md`
- `03-完整大纲.md` 中的设定部分
- `04-人物宝典/` 中的能力设定

**输出**：
- 核心设定回顾
- 冲突问题列表
- 修改建议（添加合理解释或修改描写）

---

### 4. 大纲偏离检查

**检查内容**：
- [ ] 是否完成大纲规定的核心事件
- [ ] 是否引入未规划的支线
- [ ] 节奏是否符合规划
- [ ] 是否遗漏关键剧情点
- [ ] 字数是否在预期范围

**输入来源**：
- `03-完整大纲.md`
- `05-场景清单.md`
- 待检查章节的实际内容

**输出**：
- 大纲要求对照
- 偏离分析（遗漏/新增）
- 补救建议

---

### 5. 伏笔回收检查

**检查内容**：
- [ ] 已埋伏笔是否在规定章节回收
- [ ] 新伏笔是否正确记录
- [ ] 伏笔回收是否有铺垫
- [ ] 是否有"烂尾"伏笔（超期未回收）

**输入来源**：
- `review/foreshadowing.json`（如有）
- `05-场景清单.md` 中的伏笔标记
- 待检查章节内容

**输出**：
- 伏笔状态更新表
- 预警（即将超期的伏笔）
- 新增伏笔列表

---

### 6. 文风一致性检查

**检查内容**：
- [ ] 叙事视角是否一致
- [ ] 语言风格是否统一
- [ ] 感官描写密度是否一致
- [ ] 是否有明显的AI痕迹
- [ ] 句式节奏是否保持
- [ ] **流水账检测**：情节是否有期待感
- [ ] **流水账检测**：是否有冲突/情绪变化

**输入来源**：
- 前几章作为参考样本
- 待检查章节内容

**输出**：
- 文风特征对比
- 偏离分析
- AI痕迹检测结果
- 流水账问题列表

**流水账检测要点**：
```
流水账警告信号：
1. 连续3段以上只是"描述发生了什么"
2. 没有任何角色的情绪反应
3. 没有冲突或矛盾
4. 读完后不记得发生了什么
5. 章节结尾没有钩子

检测问题：
- 本章是否有明确的冲突？
- 读者会感到什么情绪？
- 结尾是否让读者期待下一章？
```

---

### 7. 开篇质量检查（仅第1-3章）

**适用范围**：仅检查小说前三章（黄金三章）

**检查内容**：
- [ ] **第1章**：开篇是否有冲突/危机/悬念
- [ ] **第1章**：信息密度是否合理（避免信息轰炸）
- [ ] **第1章**：是否避免了寡淡开场
- [ ] **第2章**：世界观是否通过剧情展开
- [ ] **第2章**：金手指/机遇是否足够吸引人
- [ ] **第3章**：是否有第一个爽点
- [ ] **第3章**：结尾是否留有钩子

**输入来源**：
- `正文/第1章.md`、`正文/第2章.md`、`正文/第3章.md`
- `00-一句话概括.md`

**输出**：
- 开篇问题列表
- 改进建议
- 黄金三章评分（0-100）

**开篇问题类型**：

| 问题类型 | 表现 | 严重程度 |
|----------|------|----------|
| 寡淡开场 | 平平无奇，没吸引力 | 高 |
| 信息轰炸 | 大量设定倾倒 | 高 |
| 拖沓入题 | 迟迟不进入正题 | 中 |
| 无爽点 | 第三章没有小高潮 | 中 |
| 无钩子 | 结尾没有悬念 | 中 |

---

### 8. 推荐评估准备检查（番茄平台）⭐新增

**适用范围**：计划在番茄平台发布，即将达到8万字或15万字的作品

**检查内容**：

#### A. 书名与简介检查

- [ ] **书名**：是否包含冲突+悬念+结果前置
- [ ] **书名**：是否包含搜索热词
- [ ] **书名**：长度是否在15字以内
- [ ] **简介**：是否有3个明确钩子
- [ ] **简介**：是否前置了最爽的结果
- [ ] **简介**：是否在前两行抓住眼球

#### B. 黄金三章检查

- [ ] **第1章**：前300字是否有爆点
- [ ] **第1章**：是否有金手指/生死危机
- [ ] **第1章**：是否避免了寡淡开场/信息轰炸
- [ ] **第2章**：是否有紧迫目标+具体阻碍
- [ ] **第2章**：世界观是否通过剧情展开
- [ ] **第3章**：是否有小爽点
- [ ] **第3章**：结尾是否有钩子

#### C. 数据预测

- [ ] 预估三章追读率能否≥35%
- [ ] 第5-10章是否有持续钩子
- [ ] 预估完读率能否≥15%
- [ ] 是否存在明显的"毒点"（主角降智、逻辑崩坏、读者反感情节）

#### D. 运营准备

- [ ] 存稿量是否足够（建议15万字）
- [ ] 是否已准备好日更4000字的节奏
- [ ] 更新时间是否固定
- [ ] 是否准备了5套书名+简介（书测备用）

**输入来源**：
- `正文/第1章.md`、`正文/第2章.md`、`正文/第3章.md`
- `00-一句话概括.md`（书名）
- `01-五句式大纲.md`（简介参考）
- 章节内容（数据预测）

**输出**：

```markdown
## 推荐评估准备报告

**评估准备评分**：[0-100分]

### 各项得分

| 检查项 | 得分 | 权重 | 加权得分 |
|--------|------|------|----------|
| 书名质量 | /20 | 20% | |
| 简介质量 | /20 | 20% | |
| 黄金三章 | /40 | 40% | |
| 数据预测 | /10 | 10% | |
| 运营准备 | /10 | 10% | |
| **总分** | /100 | 100% | |

### 关键问题

| 问题 | 严重程度 | 影响 | 建议修改 |
|------|----------|------|----------|
| ... | 高/中/低 | ... | ... |

### 是否建议立即发起评估

- [ ] ✅ 建议立即发起（评分≥80分）
- [ ] ⚠️ 建议优化后发起（评分60-79分）
- [ ] ❌ 建议暂停，先解决关键问题（评分<60分）

### 优化建议

1. [优先级1] ...
2. [优先级2] ...
3. [优先级3] ...
```

**评分标准**：

| 分数段 | 建议 | 说明 |
|--------|------|------|
| ≥80分 | 立即发起评估 | 内容质量较高，通过概率大 |
| 60-79分 | 优化后发起 | 存在可改进点，建议修改后再评估 |
| <60分 | 暂停评估 | 存在关键问题，建议先解决 |

**使用方式**：
```bash
/novel-review --评估准备
/novel-review --fanqie-check        # 别名
/novel-review 第1-10章 --评估准备   # 检查前10章
```

---

## 执行流程

### Step 1：识别项目结构

1. 扫描当前目录或指定目录
2. 识别小说项目结构：
   ```
   [小说目录]/
   ├── 00-一句话概括.md
   ├── 01-五句式大纲.md
   ├── 02-人物卡片/
   ├── 03-完整大纲.md
   ├── 04-人物宝典/
   ├── 05-场景清单.md
   ├── 正文/
   │   ├── 第1章.md
   │   └── ...
   └── review/                    ← 复核输出（自动创建）
   ```

### Step 2：确定检查范围

1. 如果指定了章节，只检查该章节
2. 如果是增量检查，比较 `review/` 中的记录，只检查新增内容
3. 如果是全面检查，检查所有已写章节

### Step 3：分派子代理（分批执行）

根据用户指定的检查项（或默认全部），**分批**启动子代理，避免 API 限流。

#### 分批策略

**批次划分**（每批最多 2 个并行）：

| 批次 | 检查项 | 原因 |
|------|--------|------|
| 第1批 | 角色一致性、设定一致性 | 独立检查，无依赖 |
| 第2批 | 时间线、伏笔回收 | 独立检查，无依赖 |
| 第3批 | 大纲偏离、开篇质量 | 开篇检查仅前三章执行 |
| 第4批 | 文风一致性 | 独立检查，含流水账检测 |
| 第5批 | 推荐评估准备（可选） | 仅番茄平台，独立检查 ⭐新增 |

**执行流程**：
```
第1批：角色 + 设定 → 等待完成
第2批：时间线 + 伏笔 → 等待完成
第3批：大纲偏离（使用时间线结果） → 等待完成
第4批：文风一致性 → 等待完成
第5批：推荐评估准备（可选，仅番茄平台） → 等待完成
→ 汇总所有结果
```

#### 用户控制并发

```bash
/novel-review --parallel 1    # 串行执行（最保守）
/novel-review --parallel 2    # 每批2个（默认）
/novel-review --parallel 3    # 每批3个（可能限流）
```

#### 单项检查（推荐用于日常）

如果只需要检查特定项，直接指定可跳过其他检查：

```bash
/novel-review 第10章 --角色     # 只检查角色，仅1个子代理
/novel-review 第10章 --时间线   # 只检查时间线，仅1个子代理
```

### Step 4：生成报告

1. 汇总所有子代理结果
2. 按严重程度排序（高/中/低）
3. 生成可读性报告
4. 更新追踪文件（角色状态、时间线、伏笔等）

---

## 输出目录结构

```
novel-output/
└── [小说名]/
    └── review/                      ← 复核输出目录
        ├── latest-report.md         ← 最新检查报告
        ├── history/                 ← 历史报告
        │   ├── chapter-05.md
        │   └── chapter-06.md
        ├── character-states.json    ← 角色状态追踪
        ├── timeline.json            ← 时间线数据
        └── foreshadowing.json       ← 伏笔追踪数据
```

---

## 报告格式

### 完整报告模板

```markdown
# 小说复核报告

**小说名称**：[小说名]
**检查时间**：[时间戳]
**检查范围**：第X章 - 第Y章
**检查项目**：[角色、时间线、设定、大纲、伏笔、文风]

---

## 执行摘要

| 检查项 | 状态 | 问题数 | 严重问题 |
|--------|------|--------|----------|
| 角色一致性 | ⚠️ | 3 | 1 |
| 时间线 | ✅ | 0 | 0 |
| 设定一致性 | ⚠️ | 2 | 0 |
| 大纲偏离 | ❌ | 1 | 1 |
| 伏笔回收 | ✅ | 0 | 0 |
| 文风一致性 | ✅ | 1 | 0 |
| 开篇质量 | ⚠️ | 2 | 1 |

**总体评估**：需要修改 [高/中/低]

---

## 1. 角色一致性检查

### 发现问题

| 角色 | 问题描述 | 严重程度 | 位置 |
|------|----------|----------|------|
| 林晚 | 第3段对话风格突变，从"简洁直接"变为"啰嗦说教" | 中 | 第X章第3段 |
| 王胖子 | 能力等级从筑基跳到金丹，未说明原因 | 高 | 第Y章第5段 |

### 建议
- 林晚：检查前文对话风格，统一为简洁直接
- 王胖子：添加突破描写或使用特殊道具解释

---

## 2. 时间线检查

### 当前时间点
- 绝对时间：2024年3月15日
- 相对时间：故事开始后第15天

### 发现问题

| 问题类型 | 描述 | 涉及章节 |
|----------|------|----------|
| 时间跳跃 | 第8章到第9章跳过了3天，未说明 | 第8→9章 |

---

## 3. 设定一致性检查

[...]

---

## 4. 大纲偏离检查

[...]

---

## 5. 伏笔回收检查

### 伏笔状态更新

| 伏笔ID | 描述 | 状态 | 埋设章节 | 计划回收 | 实际回收 |
|--------|------|------|----------|----------|----------|
| F001 | 神秘玉佩 | 已回收 | 第3章 | 第15章 | 第15章 ✓ |
| F002 | 师傅的遗言 | 待回收 | 第5章 | 第20章 | - |

### 预警
- F002 师傅的遗言：计划在第20章回收，当前第18章，请及时处理

---

## 6. 文风一致性检查

### AI痕迹检测

- 高频AI词：发现2处（"深入人心"、"交织"）
- 建议修改位置：第X章第Y段

---

## 优先修改建议

1. [高] 王胖子能力等级突变 - 需添加合理解释
2. [中] 林晚对话风格 - 统一人物语感
3. [低] AI痕迹 - 人语化处理

---

## 追踪数据更新

本次检查已更新以下追踪文件：
- `character-states.json` - 更新角色状态
- `timeline.json` - 更新时间线
- `foreshadowing.json` - 新增2条伏笔记录
```

---

## 子代理调用示例

### 角色一致性检查子代理

```markdown
你是小说角色一致性检查专家。

**输入**：
1. 角色设定：[从人物宝典读取]
2. 待检查章节：[章节内容]
3. 前置状态：[上一章的角色状态摘要]

**任务**：
检查待检查章节中，角色表现是否与设定一致。

**检查维度**：
- 性格行为
- 对话风格
- 能力等级
- 人物关系
- 外貌描述
- 口头禅/习惯

**输出格式**：
| 角色 | 问题 | 严重程度 | 位置 | 建议修改 |
```

### 时间线检查子代理

```markdown
你是小说时间线检查专家。

**输入**：
1. 已有时间线：[timeline.json]
2. 待检查章节：[章节内容]

**任务**：
1. 提取章节中的时间标记
2. 与已有时间线对比
3. 检查是否存在矛盾

**检查维度**：
- 时间流逝合理性
- 季节/天气连贯性
- 角色年龄正确性
- 事件顺序逻辑

**输出格式**：
1. 当前时间点更新
2. 问题列表
3. 更新后的时间线摘要
```

---

## 与其他技能的配合

推荐工作流：

```
创作流程：
snowflake-fiction → novel-review → humanize-text → novel-export
      ↑                  ↓
      └── 根据反馈修改 ←─┘
```

完整流程：
1. 使用 snowflake-fiction 创作章节
2. 使用 novel-review 检查一致性
3. 根据报告修改问题
4. 使用 humanize-text 人语化
5. 再次 review 确认质量
6. 使用 novel-export 导出

---

## 注意事项

1. **首次检查**：如果是第一次运行，会创建 `review/` 目录和追踪文件
2. **增量检查**：建议每写完一章就检查，问题更容易定位
3. **全面检查**：每完成一卷或每10章，进行一次全面检查
4. **追踪文件**：`review/` 目录下的 JSON 文件用于跨章节追踪，请勿手动删除
5. **性能考虑**：对于超长章节（>10000字），子代理会分段处理

---

## API 限流应对策略

### 问题原因

同时启动多个子代理会触发 API 限流，表现为：
- 请求被拒绝（429 错误）
- 响应变慢
- 部分检查失败

### 推荐方案

#### 方案1：单项检查（最佳）

日常使用只检查最需要的项目：

```bash
# 写完一章后，只检查角色一致性
/novel-review 第10章 --角色

# 检查时间线是否连贯
/novel-review 第10章 --时间线
```

**优点**：只启动 1 个子代理，不会限流，速度快

#### 方案2：降低并发度

```bash
# 串行执行（最保守，不会限流）
/novel-review --parallel 1

# 默认（每批2个）
/novel-review --parallel 2
```

#### 方案3：分阶段检查

将全面检查拆分为多次：

```bash
# 第一阶段：角色+设定
/novel-review --角色 --设定

# 第二阶段：时间线+伏笔
/novel-review --时间线 --伏笔

# 第三阶段：大纲+文风
/novel-review --大纲 --文风
```

### 日常检查建议

| 场景 | 推荐命令 | 子代理数 |
|------|----------|----------|
| 每章检查 | `--角色` | 1 |
| 每5章检查 | `--角色 --时间线` | 2（同一批） |
| 每10章检查 | `--全文 --parallel 1` | 6（串行） |
| 8万字节点（番茄） | `--评估准备` | 1 ⭐新增 |
| 完本前检查 | `--全文` | 6（分4批） |

---

## 相关资源

- [一致性检查提示词模板](./references/consistency-check-prompt.md)
- [角色状态追踪模板](./references/character-state-template.md)
- [时间线追踪模板](./references/timeline-template.md)
- [伏笔追踪模板](./references/foreshadowing-tracker.md)
- [复核报告模板](./references/review-report-template.md)
